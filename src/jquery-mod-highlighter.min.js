(function(e,t){var n="hasModificationHighlighter";var r="panels-ignore-modified";var i="panels-evaluate-modified";var s="tracker-input-modifiable";var o="tracker-input-modified";var u="data-tracker-original-value";var a="data-mh-rb-original-value-";var f="data-mh-change-event-flag";e.widget("dtg.modificationHighlighter",{options:{addlSelectableInputTypes:"",inputNotModifiedIfHasClass:"error",modifiedColumnClass:"ui-state-highlight",modifiedLabelClass:"ui-state-highlight"},_create:function(){this._assertContainerHasId();this._assertUniqueId();var e=this.element.attr("id");this.storeOriginalValues(e);this.element.addClass(n)},_assertContainerHasId:function(){var e=this.element.attr("id");if(this._isNullOrUndefined(e)||e.length===0){throw"The container which this plugin is running against must contain an ID attribute."}},_assertUniqueId:function(){var t=e("#"+this.element.attr("id")).length===1;if(t>1){throw"The container ID must be unique within the DOM.  There are "+t+' elements which have the "'+this.element.attr("id")+'" ID.'}},_init:function(){var e=this.element.attr("id");this._defineChangeEvent(e)},_setOption:function(e,t){this.options[e]=t},getModifiedColumns:function(e){var t=[];t.push(o);t.push(this.options.inputNotModifiedIfHasClass);var n=this._createSelectorForInputTypes(e,t);var r=this._createColumnsUsingSelector(n);return r},getAllColumnsWithSuppliedClass:function(e,t){var n=[];if(this._isNullOrUndefined(t)){return n}var r=[];r.push(t);var i=this._createSelectorForInputTypes(e,r);n=this._createColumnsUsingSelector(i);return n},getStoredInputColumns:function(e){var t=[];t.push(s);var n=this._createSelectorForInputTypes(e,t);var r=this._createColumnsUsingSelector(n);return r},_createColumnsUsingSelector:function(t){var n=[];var r=this;e(t).each(function(){var t=e(this);var i=r._getKeyForInputValueStorage(t);var s=r._getLabelTextForInputId(i);var o=r._getValueOfInput(t);if(r._tempStoreUncheckedRadioButtonOriginalValue(t)){return true}var a=t.data(u);var f=r._createColumnStructure(i,o,a,s);n.push(f)});this._storeRadioButtonOriginalValueOnColumns(n);this._removeTempStoreUncheckedRadioButtonOriginalValue();return n},_createColumnStructure:function(e,t,n,r){var i={id:e,value:t,originalValue:n,label:r};return i},getStoredInputValue:function(e,t){var n=this.getStoredInputColumns(e);var r=null;for(var i=0;i<n.length;i++){var s=n[i];if(s.id===t){r=s;break}}return r},_tempStoreUncheckedRadioButtonOriginalValue:function(e){if(!this._isRadioButton(e)){return false}if(this._isChecked(e)){return false}var t=e.data(u);if(this._isNotNullAndNotUndefined(t)){var n=this._getKeyForInputValueStorage(e);var r=a+n;this.element.attr(r,t)}return true},_removeTempStoreUncheckedRadioButtonOriginalValue:function(){var t=e("#"+this.element.attr("id"));var n=e(t[0].attributes);n.each(function(e){var n=this.nodeName;if(n.indexOf(a)>=0){t.removeAttr(n)}})},_storeRadioButtonOriginalValueOnColumns:function(e){for(var n=0;n<e.length;n++){var r=e[n];if(e.originalValue===t){var i=this.element.attr(a+r.id);if(this._isNotNullAndNotUndefined(i)){r.originalValue=i}}}},evaluate:function(t){var n=[];n.push(o);n.push(this.options.inputNotModifiedIfHasClass);var r=this._createSelectorForInputTypes(t,n);e(r).trigger("change")},reset:function(t){var n=e.Event("beforeResetModifiedColumns");this._trigger("beforeResetModifiedColumns",n,{element:this.element,containerId:t});if(n.isDefaultPrevented()){return}var r=this.getModifiedColumns(t);for(var i=0;i<r.length;i++){var s=r[i];var o=this._findInputObjectByColumn(t,s.id);var u=e.Event("resetModifiedColumnsIteration");this._trigger("resetModifiedColumnsIteration",u,{element:this.element,column:s,input:o,index:i});if(u.isDefaultPrevented()){continue}if(this._isCheckBox(o)){if(s.originalValue==="true"){o.attr("checked","checked")}else{o.removeAttr("checked")}o.trigger("change");continue}if(this._isRadioButton(o)){var a=s.id;var f=this._escapeValue(s.originalValue);var l=e("#"+this.element.attr("id")+" input:radio[value='"+f+"']");this._setRadioChecked(l,true);o.trigger("change");continue}o.val(s.originalValue);o.removeClass(this.options.inputNotModifiedIfHasClass);o.trigger("change")}var c=e.Event("afterResetModifiedColumns");this._trigger("afterResetModifiedColumns",c,{element:this.element,containerId:t})},_findInputObjectByColumn:function(t,n){var r=e(this._formatSelectorForContainerId(t)+" "+this._prepId(n));if(r.length===0){var i=this._escapeValue(n);if(this._isNullOrUndefined(t)){r=e("[name="+i+"]")}else{r=e(this._prepId(t)+" [name="+i+"]")}}return r},storeOriginalValues:function(t){var n=this._createSelectorForInputTypes(t,null);var o=this;e(n).each(function(){var t=e(this);var n=o._isExceptionToRule(t,r,i);if(n){return true}if(o._isRadioButton(t)){if(!t.is(":checked")){o._setInputAsNotModified(t);t.removeData(u);return true}}if(o._isWorthyOfStorage(t)){var a=o._getValueOfInput(t);t.data(u,a);t.addClass(s);t.trigger("change")}})},setOriginalValues:function(t,n){if(this._isNullOrUndefined(n)||n.length===0){return}for(var r=0;r<n.length;r++){var i=n[r];var s=this._findInputObjectByColumn(t,i.id);if(this._isRadioButton(s)){for(var o=0;o<s.length;o++){var a=e(s[o]);if(a.val()===i.originalValue){a.data(u,i.originalValue)}else{a.removeData(u)}}}else{s.data(u,i.originalValue)}s.trigger("change")}},_defineChangeEvent:function(t){var n=this._createSelectorForInputTypes(t,null);var r=this;e(n).each(function(t){var n=e(this);if(r._hasNoAttribute(n,f)){n.on("change",function(t){var n=e(this);if(r._isIgnoreChange(n)){return true}if(r._isModified(n)){r._setInputAsModified(n)}else{r._setInputAsNotModified(n)}var i=e.Event("afterChange");r._trigger("afterChange",i,{element:this.element,input:n})});r._setAttribute(n,f,"Y")}})},_isModified:function(n){var r=false;var i=n.data(u);var s=this._getValueOfInput(n);if(this._isRadioButton(n)){var o=this._getKeyForInputValueStorage(n);var a=this.element.attr("id");var f=this;e("#"+a+" input[name='"+o+"']").each(function(n){var r=e(this);if(f._isChecked(r)){s=r.val()}if(r.data(u)!==t){i=r.data(u)}})}if(this._isNullOrUndefined(i)&&this._isNullOrUndefined(s)){r=false}else if(this._isNotNullAndNotUndefined(i)&&this._isNullOrUndefined(s)){r=true}else if(this._isNullOrUndefined(i)&&this._isNotNullAndNotUndefined(s)){r=true}else{r=i.toString()!==s.toString()}var l=e.Event("isInputModified");var c={element:this.element,input:n,modified:r};this._trigger("isInputModified",l,c);r=c.modified;return r},_createSelectorForInputTypes:function(t,n){var r=this._formatSelectorForContainerId(t);if(this._isNullOrUndefined(n)){n=[];n.push("")}var i=e.trim(this.options.addlSelectableInputTypes);var s="";for(var o=0;o<n.length;o++){var u=n[o];if(u!==""){u="."+u}if(o>0){s+=", "}s+=this._getSelectableInputTypes(r,i,u)}return s},_formatSelectorForContainerId:function(e){var t=this.element.attr("id");if(t===e){e=null}var n="#"+e+" ";if(this._isNullOrUndefined(e)){n=""}if(n===""){n="#"+t}else{n="#"+t+" "+n}return n+" "},_getSelectableInputTypes:function(t,n,r){var i=null;var s="input:text,input:checkbox,input:radio,input[type=email],select,textarea".split(",");var o=null;if(n.length>0){o=n.split(",");i=s.concat(o)}else{i=s}var u=[];for(var a=0;a<i.length;a++){var f=e.trim(i[a]);var l=t+f+r+", ";u.push(l)}var c=u.join("");var h=c.lastIndexOf(", ");return c.substring(0,h)},_isIgnoreChange:function(e){var t=this.options.inputNotModifiedIfHasClass;if(t!==""&&e.hasClass(t)){return true}if(this._isExceptionToRule(e,r,i)){return true}return false},_isExceptionToRule:function(e,t,n){var r=e.hasClass(t);if(r){return true}var i=this._isNotNullAndNotUndefined(n)&&e.hasClass(n);if(!i){var s=e.parents("."+t);if(s.length>0){return true}}return false},_getKeyForInputValueStorage:function(e){var t=e.attr("id");if(this._isNullOrUndefined(t)||this._isRadioButton(e)){t=e.attr("name")}return t},_setClass:function(t,n,r){if(this._isNullOrUndefined(n)||e.trim(n).length===0){return}if(r){t.addClass(n)}else{t.removeClass(n)}},_setInputAsModified:function(t){if(this._isRadioButton(t)){this._highlightRadio(t,true)}else{this._setClass(t,this.options.modifiedColumnClass,true);t.addClass(o);var n=this._getLabelForInput(t);if(n!==null&&n.length>0){this._setClass(n,this.options.modifiedLabelClass,true)}}var r=e.Event("markInputAsModified");this._trigger("markInputAsModified",r,{element:this.element,input:t})},_setInputAsNotModified:function(t){if(this._isRadioButton(t)){this._highlightRadio(t,false)}else{this._setClass(t,this.options.modifiedColumnClass,false);t.removeClass(o);var n=this._getLabelForInput(t);if(n!==null&&n.length>0){this._setClass(n,this.options.modifiedLabelClass,false)}}var r=e.Event("markInputAsNotModified");this._trigger("markInputAsNotModified",r,{element:this.element,input:t})},_highlightRadio:function(t,n){var r=this;var i=this._getKeyForInputValueStorage(t);var s="#"+this.element.attr("id")+" input[name="+this._escapeValue(i)+"]";e(s).each(function(t){var i=e(this);if(n){r._setClass(i,r.options.modifiedColumnClass,true);i.addClass(o)}else{r._setClass(i,r.options.modifiedColumnClass,false);i.removeClass(o)}var s=i.attr("id");if(r._isNotNullAndNotUndefined(s)){var u=r._getLabelById(s);if(u!==null&&u.length>0){if(n){r._setClass(u,r.options.modifiedLabelClass,true)}else{r._setClass(u,r.options.modifiedLabelClass,false)}}}})},_getLabelForInput:function(e){var t=this._getKeyForInputValueStorage(e);var n=this._getLabelById(t);if(n.length===0){t=e.attr("id");if(this._isNotNullAndNotUndefined(t)){n=this._getLabelById(t)}}return n},_getLabelById:function(t){if(this._isNullOrUndefined(t)){return null}var n=this.element.attr("id");var r=this._escapeValue(t);var i=e("#"+n+" label[for="+r+"]");return i},_getLabelTextForInputId:function(e){var t="";var n=this._getLabelById(e);if(n!==null&&n.length>0){t=n.text()}return t},_isRadioButtonAndChecked:function(e){return this._isRadioButton(e)&&this._isChecked(e)},_isChecked:function(e){return e.prop("checked")},_isRadioButton:function(e){return e.attr("type")==="radio"},_resetRadio:function(t,n){for(var r=0;r<t.length;r++){var i=e(t[r]);if(i.val()===n){this._setRadioChecked(i,true);break}}},_isWorthyOfStorage:function(e){var t=this._getKeyForInputValueStorage(e);return this._isNotNullAndNotUndefined(t)&&t.length>0},_getValueOfInput:function(e){var t="";if(this._isCheckBox(e)){if(this._isChecked(e)){t="true"}else{t="false"}}if(t===""){t=e.val();if(t===null){t=""}}return t},_isCheckBox:function(e){return e.attr("type")==="checkbox"},_prepId:function(e){if(this._isNullOrUndefined(e)){return""}if(e.indexOf("#")<0){e="#"+e}return e},_isNullOrUndefined:function(e){return e===null||e===t},_isNotNullAndNotUndefined:function(e){return e!==t&&e!==null},_escapeValue:function(e){e=e.replace(/\+/g,"\\+");e=e.replace(/\\/g,"\\");e=e.replace(/\//g,"\\/");e=e.replace(/!/g,"\\!");e=e.replace(/"/g,'\\"');e=e.replace(/#/g,"\\#");e=e.replace(/\$/g,"\\$");e=e.replace(/%/g,"\\%");e=e.replace(/&/g,"\\&");e=e.replace(/'/g,"\\'");e=e.replace(/\(/g,"\\(");e=e.replace(/\)/g,"\\)");e=e.replace(/\*/g,"\\*");e=e.replace(/,/g,"\\,");e=e.replace(/\./g,"\\.");e=e.replace(/:/g,"\\:");e=e.replace(/;/g,"\\;");e=e.replace(/\?/g,"\\?");e=e.replace(/@/g,"\\@");e=e.replace(/\[/g,"\\[");e=e.replace(/\]/g,"\\]");e=e.replace(/\^/g,"\\^");e=e.replace(/`/g,"\\`");e=e.replace(/\{/g,"\\{");e=e.replace(/\}/g,"\\}");e=e.replace(/\|/g,"\\|");e=e.replace(/\~/g,"\\~");return e},_hasAttribute:function(e,t){var n=e.attr(t);return typeof n!=="undefined"&&n!==false},_hasNoAttribute:function(e,t){return!this._hasAttribute(e,t)},_setAttribute:function(e,t,n){e.attr(t,n)},_removeAttribute:function(e,t){e.removeAttr(t)},_getAttribute:function(e,t){return e.attr(t)},_setRadioChecked:function(e,t){if(t){e.prop("checked",true)}else{e.removeAttr("checked")}}});e.extend(e.dtg.modificationHighlighter,{version:"1.1.0"})})(jQuery)